<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>s c h l a u g h</title>
    <link href="https://fonts.googleapis.com/css?family=Crimson+Pro|Gurajada|Lora|Montserrat|Open+Sans|Rajdhani|Roboto|Roboto+Slab|Source+Code+Pro|Space+Mono&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/assets/main.css">
    <script src="/assets/openpgp.min.js"></script>
    <script src="/assets/jscolor.js"></script>
    <script src="/app/pool.js"></script>
    <script src="/app/main.js"></script>
	  <link rel="icon" type="image/png" href="/assets/favicon.png" id='dynamic-favicon'>
    <script defer src="https://use.fontawesome.com/releases/v5.2.0/js/all.js" integrity="sha384-4oV5EgaV02iISL2ban6c/RmotsABqE4yZxZLcYMAdG7FAPsyHYAPpywE9PJo+Khy" crossorigin="anonymous"></script>

    <% if (user && typeof settings !== "undefined" && typeof settings.colors !== "undefined") { %>
      <style media="screen">
        .post, .message, .editor, #settings-box, #thread-list, button, .pop-up, .post-background {
          background-color: <%= settings.colors.postBackground %>;
        }
        body, h1, input, select, .post, .message, .editor, #settings-box, #thread-list, button, .not-special, .pop-up, .post-background {
          color: <%= settings.colors.text %>;
        }
        button {border-color: <%= settings.colors.text %>;}
        a, a.visited, a.hover, .special {
          color: <%= settings.colors.linkText %>;
        }
        body, h1, input, select {
          background-color: <%= settings.colors.background %>;
        }
        input:-webkit-autofill {
          -webkit-box-shadow: 0 0 0 1000px <%= settings.colors.background %> inset;
          -webkit-text-fill-color: <%= settings.colors.text %>;
        }
      </style>
    <% } %>

  </head>
  <body>
    <header>
      <a href="/" onclick="backToMain(event);"><h1>schlaugh</h1></a>

      <nav class="user-info">
        <a id="username" class="clicky removed special user-info-item"></a>
        <text id="sign-in" class="clicky user-info-item" onclick="passPromptSubmit()">schlaugh in</text>
        <text id="sign-out" class="clicky removed user-info-item" onclick="signOut()">schlaugh out</text>
      </nav>
    </header>

    <main id="main">
      <%- include("main") %>
    </main>


    <% if (user) { %>
      <% if (typeof author !== "undefined") { %>
        <% if (post_id) { %>
          <script type="text/javascript">
            var author = <%- JSON.stringify(author) %>;
            var post_id = <%- JSON.stringify(post_id) %>;
            var date = <%- JSON.stringify(date) %>;
            fetchData(function () {openPost(author, post_id, date)});
          </script>
        <% } else if (tag) { %>
          <script type="text/javascript">
            var authorID = <%- JSON.stringify(author) %>;
            var tag = <%- JSON.stringify(tag) %>;
            fetchData(function () {filterAuthorByTag(authorID, tag)});
          </script>
        <% } else if (page) { %>
          <script type="text/javascript">
            var authorID = <%- JSON.stringify(author) %>;
            var page = <%- JSON.stringify(page) %>;
            fetchData(function () {openAuthorPanel(authorID, function () {turnAuthorPage(authorID, null, page)})});
          </script>
        <% } else { %>
          <script type="text/javascript">
            fetchData(function () {openAuthorPanel(<%- JSON.stringify(author) %>)});
          </script>
        <% } %>
      <% } else if (typeof post_id !== "undefined") { %>
        <% if (typeof ever !== "undefined") { %>
          <script type="text/javascript">
            fetchData(function () {
              simulatePageLoad("~/"+<%- JSON.stringify(post_id) %>, "404s & Heartbreak");
              open404page('ever');
            });
          </script>
        <% } else if (post_id === false) { %>
          <script type="text/javascript">
            fetchData(function () {
              simulatePageLoad(true, "404s & Heartbreak");
              open404page('author');
            });
          </script>
        <% } else { %>
          <script type="text/javascript">
            fetchData(function () {
              simulatePageLoad("~/"+<%- JSON.stringify(post_id) %>, "404s & Heartbreak");
              open404page('post');
            });
          </script>
        <% } %>
      <% } else if (typeof tag !== "undefined") { %>
        <script type="text/javascript">
          fetchData(function () {loadPosts(0, <%- JSON.stringify(tag) %>)});
        </script>
      <% } else if (typeof about !== "undefined") { %>
        <script type="text/javascript">fetchData(function () {switchPanel("~about-panel")});</script>
      <% } else if (typeof faq !== "undefined") { %>
        <script type="text/javascript">fetchData(function () {openFAQ();});</script>
      <% } else { %>
        <script type="text/javascript">fetchData(function () {switchPanel(<%- JSON.stringify(panel) %>+"-panel")});</script>
      <% } %>
    <% } else { %>
        <script type="text/javascript">
          setAppearance();
        </script>
      <% if (typeof author !== "undefined") { %>
        <% if (post_id) { %>
          <script type="text/javascript">
            var author = <%- JSON.stringify(author) %>;
            var post_id = <%- JSON.stringify(post_id) %>;
            var date = <%- JSON.stringify(date) %>;
            openPost(author, post_id, date);
            //setAppearance();
          </script>
        <% } else if (tag) { %>
          <script type="text/javascript">
            var authorID = <%- JSON.stringify(author) %>;
            var tag = <%- JSON.stringify(tag) %>;
            filterAuthorByTag(authorID, tag);
          </script>
        <% } else if (page) { %>
          <script type="text/javascript">
            var authorID = <%- JSON.stringify(author) %>;
            var page = <%- JSON.stringify(page) %>;
            openAuthorPanel(authorID, function () {turnAuthorPage(authorID, null, page)})
          </script>
        <% } else { %>
          <script type="text/javascript">
            openAuthorPanel(<%- JSON.stringify(author) %>);
          </script>
        <% } %>
      <% } else if (typeof post_id !== "undefined") { %>
        <% if (typeof ever !== "undefined") { %>
          <script type="text/javascript">
            simulatePageLoad("~/"+<%- JSON.stringify(post_id) %>, "404s & Heartbreak");
            open404page('ever');
          </script>
        <% } else if (post_id === false) { %>
            <script type="text/javascript">
              simulatePageLoad(true, "404s & Heartbreak");
              open404page('author');
            </script>
        <% } else { %>
          <script type="text/javascript">
            simulatePageLoad("~/"+<%- JSON.stringify(post_id) %>, "404s & Heartbreak");
            open404page('post');
          </script>
        <% } %>
      <% } else if (typeof tag !== "undefined") { %>
        <script type="text/javascript">
          loadPosts(0, <%- JSON.stringify(tag) %>);
        </script>
      <% } else if (typeof recovery !== "undefined") { %>
        <% if (recovery) { %>
          <script type="text/javascript">switchPanel("recovery-panel"); glo.resetCode = <%- JSON.stringify(recovery) %>;</script>
        <% } else { %>
          <script type="text/javascript">switchPanel("bad-recovery-panel");</script>
          <% } %>
      <% } else if (typeof about !== "undefined") { %>
        <script type="text/javascript">switchPanel("~about-panel");</script>
      <% } else if (typeof faq !== "undefined") { %>
        <script type="text/javascript">openFAQ();</script>
      <% } else { %>
        <script type="text/javascript">simulatePageLoad(); switchPanel("login-panel");</script>
      <% } %>
    <% } %>

    <footer>
      <%
        var date = new Date(new Date().getTime() - 9*3600*1000);  //UTC offset by -9
        var hoursRemaining = "< " + (24 - date.getUTCHours()) + " hours to schlaupdate";
      %>
      <text><%= hoursRemaining %></text>
      <br>
      <div id="footer-footer" class="removed">
        <a href="/~" class="clicky footer-text" onclick="modKeyCheck(event, function () {switchPanel('~about-panel'); simulatePageLoad('~', false);});">about</a>
        â€¢
        <a href="/~faq" class="clicky footer-text" onclick="modKeyCheck(event, function () {openFAQ();});">faq</a>
      </div>
    </footer>

  </body>
</html>
